<!-- *********************************************************************** -->
<!--                                                                         -->
<!--                                                      :::      ::::::::  -->
<!-- upload_test.html                                   :+:      :+:    :+:  -->
<!--                                                  +:+ +:+         +:+    -->
<!-- By: vflores- <vflores-@student.42luxembou      +#+  +:+       +#+       -->
<!--                                              +#+#+#+#+#+   +#+          -->
<!-- Created: 2025/08/18 17:21:57 by vflores-          #+#    #+#            -->
<!-- Updated: 2025/08/18 17:21:58 by vflores-         ###   ########.fr      -->
<!--                                                                         -->
<!-- *********************************************************************** -->

<!DOCTYPE html>
<html>
<head>
    <title>Upload Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .container { max-width: 600px; margin: 0 auto; }
        h1 { color: #333; }
        form { background: #f4f4f4; padding: 20px; border-radius: 8px; margin: 20px 0; }
        input[type="file"], input[type="submit"] { margin: 10px 0; }
        input[type="submit"] {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        input[type="submit"]:hover { background: #0056b3; }
        .file-list { margin-top: 30px; }
        .file-item {
            background: white;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .delete-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
        }
        .delete-btn:hover { background: #c82333; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Webserv Upload Test</h1>

        <h2>Upload File</h2>
        <form action="/uploads" method="post" enctype="multipart/form-data">
            <input type="file" name="file" required>
            <br>
            <input type="submit" value="Upload File">
        </form>

        <h2>Upload Text</h2>
        <form action="/uploads" method="post">
            <textarea name="content" rows="4" cols="50" placeholder="Enter text to upload..."></textarea>
            <br>
            <input type="submit" value="Upload Text">
        </form>

        <div class="file-list">
            <h2>Uploaded Files</h2>
            <p>Visit <a href="/uploads/">/uploads/</a> to see all files</p>

            <div id="files"></div>
        </div>

        <script>

            function deleteFile(filename) {
                if(confirm('Delete ' + filename + '?')) {
                    fetch('/uploads/' + filename, {
                        method: 'DELETE'
                    })
                    .then(response => {
                        if(response.ok) {
                            alert('File deleted successfully');
                            location.reload();
                        } else {
                            alert('Failed to delete file');
                        }
                    })
                    .catch(error => {
                        alert('Error: ' + error);
                    });
                }
            }


            fetch('/uploads/')
                .then(response => response.text())
                .then(html => {

                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    const links = doc.querySelectorAll('a');
                    const filesDiv = document.getElementById('files');

                    links.forEach(link => {
                        const filename = link.textContent;
                        if(filename !== '../' && filename !== 'Parent Directory') {
                            const fileItem = document.createElement('div');
                            fileItem.className = 'file-item';
                            fileItem.innerHTML = `
                                <span>${filename}</span>
                                <button class="delete-btn" onclick="deleteFile('${filename}')">Delete</button>
                            `;
                            filesDiv.appendChild(fileItem);
                        }
                    });
                });
        </script>
    </div>
</body>
</html>
